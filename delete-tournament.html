<!DOCTYPE html>
<html>
<head>
    <title>Delete Tournament</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .tournament { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .delete-btn { background: red; color: white; padding: 5px 10px; border: none; cursor: pointer; }
        .delete-btn:hover { background: darkred; }
    </style>
</head>
<body>
    <h1>Tournament Manager</h1>
    <div id="tournaments"></div>

    <script>
        // Load tournaments from localStorage
        const history = JSON.parse(localStorage.getItem('tournamentHistory') || '[]');
        const current = localStorage.getItem('currentTournament');
        
        let allTournaments = [...history];
        if (current) {
            const currentTournament = JSON.parse(current);
            // Add current tournament if not already in history
            if (!history.find(t => t.id === currentTournament.id)) {
                allTournaments.unshift(currentTournament);
            }
        }

        const container = document.getElementById('tournaments');
        
        if (allTournaments.length === 0) {
            container.innerHTML = '<p>No tournaments found</p>';
        } else {
            allTournaments.forEach(tournament => {
                const div = document.createElement('div');
                div.className = 'tournament';
                div.innerHTML = `
                    <h3>Tournament: ${tournament.date}</h3>
                    <p><strong>ID:</strong> ${tournament.id}</p>
                    <p><strong>Access Code:</strong> ${tournament.accessCode}</p>
                    <p><strong>Finalized:</strong> ${tournament.isFinalized ? 'Yes' : 'No'}</p>
                    <p><strong>Created:</strong> ${new Date(tournament.createdAt).toLocaleString()}</p>
                    <button class="delete-btn" onclick="deleteTournament('${tournament.id}', '${tournament.date}')">
                        Delete This Tournament
                    </button>
                `;
                container.appendChild(div);
            });
        }

        async function deleteTournament(id, date) {
            if (!confirm(`Are you sure you want to delete the tournament from ${date}?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/tournaments/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('Tournament deleted successfully!');
                    
                    // Remove from localStorage
                    const history = JSON.parse(localStorage.getItem('tournamentHistory') || '[]');
                    const updatedHistory = history.filter(t => t.id !== id);
                    localStorage.setItem('tournamentHistory', JSON.stringify(updatedHistory));
                    
                    // Remove from current tournament if it matches
                    const current = localStorage.getItem('currentTournament');
                    if (current) {
                        const currentTournament = JSON.parse(current);
                        if (currentTournament.id === id) {
                            localStorage.removeItem('currentTournament');
                        }
                    }
                    
                    // Reload page to show updated list
                    location.reload();
                } else {
                    const error = await response.json();
                    alert(`Error deleting tournament: ${error.error || 'Unknown error'}`);
                }
            } catch (error) {
                alert(`Error deleting tournament: ${error.message}`);
            }
        }
    </script>
</body>
</html>
